<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QLOCKTWO-style Word Clock</title>
    <style>
      :root {
        color-scheme: dark;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        background: #000;
        color: #fff;
        display: grid;
        place-items: center;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", "Courier New", monospace;
      }

      /* Clock face */
      .clock-face {
        position: relative;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      /* Letter grid */
      .grid {
        display: grid;
        grid-template-columns: repeat(11, 1ch);
        gap: 0.15em;
        font-weight: 600;
        font-size: clamp(14px, 8vmin, 56px);
        line-height: 1;
      }
      .cell {
        width: 1ch;
        height: 1em;
        display: grid;
        place-items: center;
        color: #fff;
        opacity: 0.5;
        transition: opacity 150ms linear;
      }
      .cell.active {
        opacity: 1;
      }

      /* Minute dots */
      .dot {
        position: absolute;
        width: 0.4em;
        height: 0.4em;
        background: #fff;
        border-radius: 50%;
        opacity: 0.5;
        transition: opacity 150ms linear;
      }
      .dot.active { opacity: 1; }
      .dot.tl { top: -0.8em; left: -0.8em; }
      .dot.tr { top: -0.8em; right: -0.8em; }
      .dot.bl { bottom: -0.8em; left: -0.8em; }
      .dot.br { bottom: -0.8em; right: -0.8em; }

      /* Hidden live region for screen readers */
      .visually-hidden {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0 0 0 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
      }

      @media (prefers-reduced-motion: reduce) {
        .cell, .dot { transition: none; }
      }
    </style>
  </head>
  <body>
    <div class="clock-face" id="clock">
      <div class="grid" id="grid" aria-hidden="true"></div>
      <div class="dot tl" aria-hidden="true"></div>
      <div class="dot tr" aria-hidden="true"></div>
      <div class="dot bl" aria-hidden="true"></div>
      <div class="dot br" aria-hidden="true"></div>
      <div id="live-time" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
    </div>

    <script>
      (function () {
        const GRID = [
          "ITLISASTIME",
          "ACQUARTERDC",
          "TWENTYFIVEX",
          "HALFBTENFTO",
          "PASTERUNINE",
          "ONESIXTHREE",
          "FOURFIVETWO",
          "EIGHTELEVEN",
          "SEVENTWELVE",
          "TENSEOCLOCK",
        ];

        // Mapping: word -> { row, start, end } inclusive
        const WORDS = {
          IT: { row: 0, start: 0, end: 1 },
          IS: { row: 0, start: 3, end: 4 },

          // Minute words
          FIVE_MIN:   { row: 2, start: 6, end: 9 },
          TEN_MIN:    { row: 3, start: 5, end: 7 },
          QUARTER:    { row: 1, start: 2, end: 8 },
          TWENTY:     { row: 2, start: 0, end: 5 },
          HALF:       { row: 3, start: 0, end: 3 },
          PAST:       { row: 4, start: 0, end: 3 },
          TO:         { row: 3, start: 9, end: 10 },
          OCLOCK:     { row: 9, start: 5, end: 10 }, // O'CLOCK without apostrophe in grid

          // Hour words
          ONE:        { row: 5, start: 0, end: 2 },
          TWO:        { row: 6, start: 8, end: 10 },
          THREE:      { row: 5, start: 6, end: 10 },
          FOUR:       { row: 6, start: 0, end: 3 },
          FIVE_HOUR:  { row: 6, start: 4, end: 7 },
          SIX:        { row: 5, start: 3, end: 5 },
          SEVEN:      { row: 8, start: 0, end: 4 },
          EIGHT:      { row: 7, start: 0, end: 4 },
          NINE:       { row: 4, start: 7, end: 10 },
          TEN_HOUR:   { row: 9, start: 0, end: 2 },
          ELEVEN:     { row: 7, start: 5, end: 10 },
          TWELVE:     { row: 8, start: 5, end: 10 },
        };

        const gridEl = document.getElementById('grid');
        const liveEl = document.getElementById('live-time');
        const dots = Array.from(document.querySelectorAll('.dot'));

        // Build the letter grid in the DOM
        const letterElements = []; // 2D array [row][col] -> element
        for (let r = 0; r < GRID.length; r++) {
          const rowStr = GRID[r];
          const rowArr = [];
          for (let c = 0; c < rowStr.length; c++) {
            const span = document.createElement('span');
            span.className = 'cell';
            span.dataset.row = String(r);
            span.dataset.col = String(c);
            span.textContent = rowStr[c];
            gridEl.appendChild(span);
            rowArr.push(span);
          }
          letterElements.push(rowArr);
        }

        // Precompute word -> list of element refs
        const wordToElements = {};
        for (const [key, range] of Object.entries(WORDS)) {
          const elements = [];
          for (let c = range.start; c <= range.end; c++) {
            elements.push(letterElements[range.row][c]);
          }
          wordToElements[key] = elements;
        }

        let currentActive = new Set(); // of element references
        let lastMinute = null; // track last seen minute to throttle updates

        function setActiveWords(wordKeys) {
          const nextActive = new Set();
          for (const key of wordKeys) {
            const els = wordToElements[key];
            if (!els) continue;
            for (const el of els) nextActive.add(el);
          }
          // Remove
          for (const el of currentActive) {
            if (!nextActive.has(el)) el.classList.remove('active');
          }
          // Add
          for (const el of nextActive) {
            if (!currentActive.has(el)) el.classList.add('active');
          }
          currentActive = nextActive;
        }

        function two(n) { return String(n).padStart(2, '0'); }

        function getHourKey(hour12) {
          switch (hour12) {
            case 1: return 'ONE';
            case 2: return 'TWO';
            case 3: return 'THREE';
            case 4: return 'FOUR';
            case 5: return 'FIVE_HOUR';
            case 6: return 'SIX';
            case 7: return 'SEVEN';
            case 8: return 'EIGHT';
            case 9: return 'NINE';
            case 10: return 'TEN_HOUR';
            case 11: return 'ELEVEN';
            case 12: return 'TWELVE';
          }
        }

        function computeWordKeys(date) {
          const h24 = date.getHours();
          const m = date.getMinutes();

          // Round minutes to nearest 5 for words
          const roundedMinutes = Math.round(m / 5) * 5; // 0..60
          let bucket = (roundedMinutes / 5) % 12; // 0..11

          let displayHour = h24;
          if (roundedMinutes === 60) {
            bucket = 0; // o'clock of next hour
            displayHour = h24 + 1;
          }

          const isTo = bucket > 6 && bucket !== 0; // 35..55 -> TO
          if (isTo) displayHour += 1;

          const hour12 = ((displayHour % 12) || 12);

          const keys = ['IT', 'IS'];

          if (bucket === 0) {
            keys.push(getHourKey(hour12));
            keys.push('OCLOCK');
            return keys;
          }

          // Minute phrase
          switch (bucket) {
            case 1: // five past
            case 11: // five to
              keys.push('FIVE_MIN');
              break;
            case 2:
            case 10:
              keys.push('TEN_MIN');
              break;
            case 3:
            case 9:
              keys.push('QUARTER');
              break;
            case 4:
            case 8:
              keys.push('TWENTY');
              break;
            case 5:
            case 7:
              keys.push('TWENTY', 'FIVE_MIN');
              break;
            case 6:
              keys.push('HALF');
              break;
          }

          keys.push(isTo ? 'TO' : 'PAST');
          keys.push(getHourKey(hour12));
          return keys;
        }

        function updateDots(date) {
          const remainder = date.getMinutes() % 5; // 0..4
          // Order: tl, tr, bl, br (1..4)
          for (let i = 0; i < dots.length; i++) {
            dots[i].classList.toggle('active', i < remainder);
          }
        }

        function updateLiveRegion(date) {
          const hh = two(date.getHours());
          const mm = two(date.getMinutes());
          liveEl.textContent = `${hh}:${mm}`;
        }

        function tick() {
          const now = new Date();
          const minute = now.getMinutes();

          // Always update dots and live region on minute change
          if (minute !== lastMinute) {
            lastMinute = minute;
            const keys = computeWordKeys(now);
            setActiveWords(keys);
            updateDots(now);
            updateLiveRegion(now);
          }
        }

        // Initial render
        tick();
        // Update every second; recompute words only when minute changes
        setInterval(tick, 1000);
      })();
    </script>
  </body>
</html>